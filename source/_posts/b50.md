---
title: Turbopack æºç è°ƒè¯•
date: 2024/06/28
tag: Rust
author: å¤šå°å‡¯
---

![image](https://github.com/xiaoxiaojx/blog/assets/23253540/9841f101-0ef1-4af6-9f97-7fac3903c833)

æˆªæ­¢ä»Šå¤©ï¼ˆ2024-06-28ï¼‰Turbopack ä»…æ”¯æŒåœ¨ Next.js é¡¹ç›®çš„å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œè¯¦ç»†è§: [Getting started](https://turbo.build/pack/docs)
![image](https://github.com/xiaoxiaojx/blog/assets/23253540/c76a37c4-9d0a-4bcb-947d-56ceb9299c04)



Turbopack æ˜¯å¦æ”¯æŒç”Ÿäº§ç¯å¢ƒæ‰“åŒ… ğŸ¤”ï¸ ï¼Ÿå¦‚ä½•è„±ç¦» Next.js ä½¿ç”¨ ğŸ¤”ï¸ ï¼Ÿå¦‚ä½•è¿›è¡Œæºç è°ƒè¯• ğŸ¤”ï¸ ï¼Ÿ

è¿™éœ€è¦æˆ‘ä»¬å…ˆå¯¹å®ƒçš„æºç å…ˆæœ‰ä¸ªåˆæ­¥çš„äº†è§£ï¼Œä¸‹é¢æ˜¯æˆ‘çš„ä¸€äº›è°ƒè¯•ç»éªŒ

## Step1: æ‹‰å–æºç 
```bash
git clone https://github.com/vercel/turbo

// åˆ‡æ¢åˆ°ç›®å‰æœ€æ–°çš„ commit, åé¢çš„è°ƒè¯•éƒ½åŸºäºè¯¥ commit
git checkout 3bca6e8415
```

## Step2: æ–°å¢ VS Code è°ƒè¯•å‘½ä»¤
Turbopack ä»£ç æŒºè§„èŒƒçš„ï¼ŒæŒ‰ç…§å¸¸ç† turbopack-cli è¿™ä¸ªåº“å°±æ˜¯æˆ‘ä»¬è°ƒè¯• Turbopack æºç çš„å…¥å£äº†
![image](https://github.com/xiaoxiaojx/blog/assets/23253540/a5b51f7e-f671-4b81-994a-27e8d17e4301)
```json
{
  "name": "turbo dev",
  "type": "lldb",
  "request": "launch",
  "program": "${workspaceRoot}/target/debug/turbopack-cli",
  "args": ["dev"],
  "cwd": "${workspaceRoot}",
  "presentation": {
    "group": "commands",
    "order": 1
  }
},
{
  "name": "turbo build",
  "type": "lldb",
  "request": "launch",
  "program": "${workspaceRoot}/target/debug/turbopack-cli",
  "args": ["build"],
  "cwd": "${workspaceRoot}",
  "presentation": {
    "group": "commands",
    "order": 1
  }
}
```

## Step3: æ„å»º turbopack-cli
```bash
cd crates/turbopack-cli
cargo build
```

## Step4: è¡¥å……ä¸€ä¸‹ turbopack-cli è¿è¡Œéœ€è¦çš„ config
### dev å‘½ä»¤
<img width="1275" alt="image" src="https://github.com/xiaoxiaojx/blog/assets/23253540/b7af0133-ffce-407c-821f-aa52a2565247">

```rs
use crate::arguments::CommonArguments;
use core::net::Ipv4Addr;
/// Start a devserver with the given args.
pub async fn start_server(args: &DevArguments) -> Result<()> {
    let mut args = DevArguments {
        port: 3000,
        hostname: IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)),
        no_open: true,
        eager_compile: false,
        allow_retry: false,
        common: CommonArguments {
            show_all: true,
            log_detail: true,
            full_stats: true,
            memory_limit: Some(1024),
            log_level: Default::default(),
            entries: Some(vec![String::from("app/page.tsx")]),
            dir: Some(PathBuf::from("/Users/xxx/my-app")),
            root: Some(PathBuf::from("/Users/xxx/my-app"))
        }
    };
```

### build å‘½ä»¤
âœ… çœ‹æ¥ turbopack æ”¯æŒç”Ÿäº§ç¯å¢ƒæ‰“åŒ…ï¼Œåªæ˜¯å®˜æ–¹è¿˜æœªå¼€æ”¾å‡ºæ¥

<img width="1273" alt="image" src="https://github.com/xiaoxiaojx/blog/assets/23253540/bb11c4e8-748d-4093-97b0-a4e005ad30ad">

```rs
use crate::arguments::CommonArguments;

pub async fn build(args: &BuildArguments) -> Result<()> {
    let mut args = BuildArguments {
        no_minify: true,
        common: CommonArguments {
            show_all: true,
            log_detail: true,
            full_stats: true,
            memory_limit: Some(1024),
            log_level: Default::default(),
            entries: Some(vec![String::from("app/page.tsx")]),
            dir: Some(PathBuf::from("/Users/xxx/my-ap")),
            root: Some(PathBuf::from("/Users/xxx/my-ap"))
        }
    };
```

## Step5: åˆ›å»ºä¸€ä¸ª React Demo é¡¹ç›®
æ¥ç€æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªç”¨äº turbopack-cli è¿›è¡Œæ‰“åŒ…çš„ React Demo é¡¹ç›®ï¼Œç„¶åæŠŠä¸Šé¢çš„ dev ä¸ build å‘½ä»¤çš„ dirã€root ç›®å½•çš„å€¼æ”¹ä¸ºä¸‹é¢å‘½ä»¤åˆ›å»ºå¥½çš„ç›®å½•
```bash
npx create-next-app --example with-turbopack
```

## Step6: ç‚¹å‡» turbo build æˆ–è€… turbo dev æ¥æ­£å¼å¼€å§‹è°ƒè¯•
![image](https://github.com/xiaoxiaojx/blog/assets/23253540/5bf80043-8438-400e-a4a7-0a4717e7d852)


## You do it!
âœ… turbopack å·²ç»èƒ½å¤Ÿè„±ç¦» Next.js ä½¿ç”¨
![image](https://github.com/xiaoxiaojx/blog/assets/23253540/bab3c83e-1237-445a-91b5-e757cc227ce8)
